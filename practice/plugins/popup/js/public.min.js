var MU = {
    msgTips: function(status, txt, timeout, callback) {
        this.removeTips();
        var flag = status.match('loading') == 'loading';
        var zindex = parseInt(new Date().getTime() / 1000);
        var html = '<div class="msgbox_layer_wrap" id="msgTips" style="z-index:' + zindex + '"><span class="msgbox_layer"><span class="icon_clear"></span><span class="icon ' + status + '"></span>' + txt + '<span class="icon_end"></span></span></div>';
        $('body').append(html);
        if (flag) {
            $("#msgTips .loading").removeClass('icon');
            if ($("div#filter").length <= 0) {
                $("body").append('<div id="loadingBg"></div>');
                $("#loadingBg").css({
                    "height": $(document).height()
                });
            }
        } else {
            $("#msgTips .icon_clear").remove();
            setTimeout(this.removeTips, timeout || 1500);
            if (callback) {
                var lon = parseInt(timeout) + 400;
                setTimeout(callback, lon);
            }
        };
    },
    removeTips: function() {
        $("#msgTips,#loadingBg").remove();
    },
    conFirm: function(title, msg, ConfirmFun) {
        var html = '<div class="dialog">' + msg + '</div><div class="btn"><a id="ConfirmFun" href="javascript:;" class="save_btn"><em>确&nbsp;定</em></a><a href="javascript:void(0)" class="clear_btn" onclick="MU.close(this)"><em>取&nbsp;消</em></a></div>';
        this.alert(html, 500, title);
        var that = this;
        if (ConfirmFun) {
            $("#ConfirmFun").on('click', function() {
                ConfirmFun();
                that.close();
            })
        }
    },
    delay: function(fn, timeout) { //延时（暂停）函数
        var dfd = $.Deferred();
        setTimeout(function() {
            dfd.resolve(fn());
        }, timeout || 0);
        return dfd.promise();
    },
    alert: function(msg, w, title, ConfirmFun, isClose) {
        var _this = this;
        var len = $("div[name=wh_alert]").length + 1;
        var html = '<div class="alert" style="width:' + w + 'px" id="wh_alert_' + len + '" name="wh_alert">';
        if (title != '') {
            html = html + '<div class="title"><a href="javascript:;" onclick="MU.close(this)"></a>' + title + '</div>' + msg;
        } else {
            html = html + msg;
        }
        if (ConfirmFun) {
            html = html + '<div class="btn"><a href="javascript:;" class="save_btn"><em>确&nbsp;定</em></a><a href="javascript:void(0)" class="clear_btn" onclick="MU.close(this)"><em>取&nbsp;消</em></a></div></div>';
            $("body").prepend(html);
            $('#wh_alert_' + len).find('.save_btn').on('click', function() {
                ConfirmFun();
                if (isClose == undefined || isClose) {
                    _this.close();
                }
            })
        } else {
            html = html + '</div>';
            $("body").prepend(html);
        }
        this.mask();
        this.center($('#wh_alert_' + len));
        if (title != '') {
            this.drag('wh_alert_' + len);
        }
    },
    show: function(obj) {
        var _this = this;
        $(window).scroll(function() {
            _this.scenter(obj);
        });
        $(window).resize(function() {
            _this.scenter(obj);
        });
    },
    scenter: function(obj) {
        var windowWidth = document.documentElement.clientWidth;
        var windowHeight = document.documentElement.clientHeight;
        var popupHeight = $(obj).height();
        var popupWidth = $(obj).width();
        $(obj).css({
            "top": (windowHeight - popupHeight) / 2 + $(document).scrollTop(),
            "left": (windowWidth - popupWidth) / 2
        });
    },
    center: function(obj, flag) {
        var _this = this;
        var windowWidth = document.documentElement.clientWidth;
        var windowHeight = document.documentElement.clientHeight;
        var popupHeight = $(obj).height();
        var popupWidth = $(obj).width();
        //var top = (windowHeight-popupHeight)/2+$(document).scrollTop() > 0 ? (windowHeight-popupHeight)/2+$(document).scrollTop() : 46;
        var top = ($(window).height() - popupHeight) / 2;
        var index = parseInt(new Date().getTime() / 1000);
        $(obj).css({
            "opacity": 0,
            "top": top - 40,
            "left": (windowWidth - popupWidth) / 2,
            "z-index": index
        });
        $(obj).animate({
            "top": '+=' + '40px',
            "opacity": "1"
        }, 400, function() {});
    },
    close: function(obj) {
        var obj = obj || $(".alert:first").find("div.title").find('a');
        $(obj).parents("div[name=wh_alert]").animate({
            "top": '-=' + '60px',
            "opacity": "0"
        }, 400, function() {
            $(obj).parents("div[name=wh_alert]").remove();
            if ($("div.alert").length <= 0)
                $("#filter").animate({
                    "opacity": "0"
                }, 400, function() {
                    $("#filter").remove();
                });
        })
    },
    loading: function(msg) {
        $("body").prepend('<div id="msg_loading" class="msgbox"><em></em><span class="loading"></span><span class="msg_right"></span></div>');
        $("#msg_loading .loading").text(msg);
        this.center($("#msg_loading"));
        this.mask();
    },
    removeLoad: function() {
        $("#msg_loading").remove();
        this.delMask();
    },
    mask: function() {
        if ($("#filter").length <= 0) {
            var mybg = "<div id='filter'></div>";
            var h = $("body").height() > document.documentElement.clientHeight ? $("body").height() : document.documentElement.clientHeight;
            $("body").append(mybg);
            $("div#filter").height(h);
            $("#filter").animate({
                "opacity": "0.75"
            }, 400);
        }
    },
    delMask: function() {
        $("#filter").remove();
    },
    drag: function(dragObj) {
        var drag = typeof dragObj === 'string' ? document.getElementById(dragObj) : dragObj;
        var dTitle = drag.getElementsByTagName('div')[0];
        var disX = disY = 0;
        var isDrag = false;
        //drag.style.position = 'absolute';
        dTitle.style.cursor = 'move';
        dTitle.onmousedown = function(evt) {
            drag.style.zIndex = parseInt(new Date().getTime() / 1000);
            evt = evt || window.event;
            isDrag = true;

            disX = evt.clientX - drag.offsetLeft;
            disY = evt.clientY - drag.offsetTop;

            this.setCapture && this.setCapture();

            return false;
        }

        dTitle.onmousemove = function(evt) {
            evt = evt || window.event;
            if (!isDrag) return false;

            drag.style.margin = 0;
            drag.style.left = evt.clientX - disX + 'px';
            drag.style.top = evt.clientY - disY + 'px';

            return false;
        }

        dTitle.onmouseup = dTitle.onblur = dTitle.onlosecapture = function() {
            isDrag = false;
            dTitle.releaseCapture && dTitle.releaseCapture();
        }
    }
};